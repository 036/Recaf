configurations {
    common
    implementation.extendsFrom common
}

dependencies {
    implementation project(':recaf-core')
}

def getDependenciesUrls(configuration) {
    def list = new ArrayList<String>()
    configuration.allDependencies.each {
        for (def repo : repositories) {
            def url = repo.repositoryUrls[0]
            if ('file' == url.scheme) {
                continue
            }
            def jarUrl = String.format("%s%s/%s/%s/%s-%s.jar", url.toString(),
                    it.group.replace('.', '/'), it.name, it.version,
                    it.name, it.version)
            try {
                new URL(jarUrl).openStream().close()
                list.add(jarUrl)
                return
            }  catch (IOException ignored) {}
        }
    }
    return list
}

jar {
    def common = getDependenciesUrls(configurations.common)
    manifest {
        attributes('Main-Class': 'me.coley.recaf.RecafUI',
        'Common-Dependencies': common.join(';'))
    }
}